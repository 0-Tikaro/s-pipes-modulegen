# baseURI: http://onto.fel.cvut.cz/ontologies/s-pipes/constraint-validation/

@prefix : <http://onto.fel.cvut.cz/ontologies/s-pipes/constraint-validation/> .
@prefix ex: <http://example.org/> .
@prefix foaf: <http://xmlns.com/foaf/0.1/> .
@prefix kbss: <http://onto.fel.cvut.cz/ontologies/lib/module/> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix sm: <http://topbraid.org/sparqlmotion#> .
@prefix sml: <http://topbraid.org/sparqlmotionlib#> .
@prefix sp: <http://spinrdf.org/sp#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .

<http://onto.fel.cvut.cz/ontologies/s-pipes/constraint-validation>
  rdf:type owl:Ontology ;
  owl:imports <http://onto.fel.cvut.cz/ontologies/s-pipes> ;
  owl:imports <http://onto.fel.cvut.cz/ontologies/s-pipes-lib> ;
.


:import-person-database
  a sml:ImportRDFFromWorkspace ;
  sm:next :constraint-validation_Return;
  sml:baseURI "http://onto.fel.cvut.cz/ontologies/s-pipes/examples/constraint-validation/people" ;
  sml:ignoreImports true ;

  kbss:has-output-graph-constraint [
   a sp:Select ;
   sp:text """# Person provided in input does not exist.

    PREFIX foaf: <http://xmlns.com/foaf/0.1/>
    PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
    SELECT *
    WHERE{
         FILTER NOT EXISTS{
            ?person foaf:lastName ?lastname;
                 	foaf:firstName ?firstname;
                 	a foaf:Person;
    	}
    }""" ;
  ];


 kbss:has-output-graph-constraint [
   a sp:Ask ;
   sp:text """# Person 'Pavel Hnizdo' does not exist
     PREFIX foaf: <http://xmlns.com/foaf/0.1/>
     PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
     ASK
     WHERE{
         ?person a foaf:Person;
         FILTER NOT EXISTS { ?person foaf:lastName "Hnizdo";
                                     foaf:firstName "Pavel" }
     }""" ;
 ] ;


  rdfs:label "Import person database" ;
.

:constraint-validation_Return
  a sml:ReturnRDF ;
  sml:serialization sml:JSONLD ;
  rdfs:label "Return data".

:constraint-validation
   a sm:Function ;
   sm:returnModule :constraint-validation_Return ;
   rdfs:subClassOf sm:Functions .
